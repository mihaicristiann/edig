---
title: "Trabajo Opcional Edig"
author: "Mihai Cristian Mihalache Farcas y Rubén Tormo Piles"
date: "2025-11-10"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    latex_engine: xelatex
---


```{r librerias, include=FALSE}
# Librerías que hemos utilizado

knitr::opts_chunk$set(
echo = TRUE, # oculta código
message = FALSE, # oculta mensajes
warning = FALSE # oculta warnings
)


library(tidyverse)
library(lubridate)
library(plm)       
library(forecast)  
library(tseries)   
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lmtest)
library(sandwich)
library(reshape2)
library(broom)
```


# 1. Introducción

El objetivo de este trabajo es **analizar empíricamente el comportamiento del turismo en las comunidades autónomas españolas** utilizando técnicas de **datos de panel** y **series temporales**. Se emplean datos mensuales de pernoctaciones, plazas de alojamiento, precio medio por noche (ADR) e índice de producción industrial (IPI), construyendo un panel regional con frecuencia inferior al año.

El análisis se estructura en dos grandes bloques. En primer lugar, se desarrolla un **modelo de datos de panel** que relaciona las pernoctaciones con sus principales determinantes (capacidad, precios y ciclo económico), siguiendo los pasos clásicos del análisis económico empírico: formulación de la pregunta de interés, construcción del modelo teórico, estimación de diferentes especificaciones (pooled, efectos fijos y efectos aleatorios) y elección del modelo más adecuado mediante contrastes estadísticos.  

En segundo lugar, se selecciona una de las variables del panel para realizar un **ejercicio de pronóstico de series temporales**. Para ello se trabaja con el paquete **`forecast`**, se aplican transformaciones y técnicas de descomposición, se estiman modelos ARIMA/ETS y se evalúa la capacidad predictiva mediante una **ventana deslizante**, comparando varios modelos en términos de error de predicción.  

A lo largo del informe se combinan resultados numéricos y gráficos con una interpretación económica cuidadosa, de modo que las conclusiones estén respaldadas tanto por la evidencia estadística como por el contexto del sector turístico español.


# 2. Datos, de donde los hemos sacado y que representan.

## 2.1. Pernoctaciones turísticas: 
```{r carga_perno, include=FALSE}
perno <- read_excel(
  "pernoctaciones.xlsx",
  skip  = 8 ,        # salta filas de título; ajusta según veas
  n_max = 20
)

names(perno)[1] <- "ccaa"

perno_long <- perno %>%
  mutate(across(-ccaa, as.character)) %>%          # columnas de meses a char
  pivot_longer(
    cols = -ccaa,
    names_to  = "periodo",                         # ej. "2025M10"
    values_to = "pernoctaciones"
  ) %>%
  mutate(pernoctaciones = as.numeric(pernoctaciones)) %>%
  separate(periodo, into = c("anio", "mes"), sep = "M") %>%
  mutate(
    anio = as.integer(anio),
    mes  = as.integer(mes)
  ) %>%
  select(ccaa, anio, mes, pernoctaciones)

```
```{r, echo = FALSE}
knitr::kable(head(perno_long))
```

La variable principal de estudio son las **pernoctaciones mensuales en establecimientos turísticos por comunidad autónoma**, obtenidas a partir de las estadísticas oficiales de ocupación publicadas por el Instituto Nacional de Estadística (INE). Esta información recoge el número total de noches que los viajeros pasan alojados en hoteles y otros tipos de alojamiento reglado, lo que constituye un indicador directo del nivel de actividad turística en cada región y mes.

En la base de datos, estas observaciones se almacenan en la columna `pernoctaciones`, junto con los identificadores de comunidad autónoma (`ccaa`), año (`anio`) y mes (`mes`), permitiendo construir un panel mensual para el periodo analizado.


## 2.2. Plazas de alojamiento
```{r carga_plazas, include=FALSE}
plazas <- read_excel(
  "plazas.xlsx",
  skip  = 8 ,        # salta filas de título; ajusta según veas
  n_max = 20
)

# 1) Renombrar la primera columna
names(plazas)[1] <- "ccaa"

plazas_long <- plazas %>%
  mutate(across(-ccaa, as.character)) %>%          # columnas de meses a char
  pivot_longer(
    cols = -ccaa,
    names_to  = "periodo",                         # ej. "2025M10"
    values_to = "plazas"
  ) %>%
  mutate(plazas = as.numeric(plazas)) %>%
  separate(periodo, into = c("anio", "mes"), sep = "M") %>%
  mutate(
    anio = as.integer(anio),
    mes  = as.integer(mes)
  ) %>%
  select(ccaa, anio, mes, plazas)
```
```{r, echo = FALSE}
knitr::kable(head(plazas_long))
```

Como medida de la **capacidad de oferta turística**, se utilizan las **plazas disponibles en establecimientos turísticos** por comunidad autónoma y mes, también procedentes de las encuestas de ocupación del INE. Esta variable refleja el número máximo de pernoctaciones que pueden atenderse en cada destino y periodo, y permite capturar diferencias estructurales en el tamaño y grado de desarrollo del sector turístico regional.

Esta información se recoge en la columna `plazas`, asociada igualmente a los identificadores temporales y regionales, lo que facilita su uso como variable explicativa en el modelo de datos de panel.


## 2.3. Índice de Producción Industrial (IPI)
```{r carga_ipi, include=FALSE}
ipi <- read_excel(
  "IPI.xlsx",
  skip  = 8 ,        # salta filas de título; ajusta según veas
  n_max = 18
)

names(ipi)[1] <- "ccaa"

ipi_long <- ipi %>%
  mutate(across(-ccaa, as.character)) %>%          # columnas de meses a char
  pivot_longer(
    cols = -ccaa,
    names_to  = "periodo",                         # ej. "2025M10"
    values_to = "ipi"
  ) %>%
  mutate(ipi = as.numeric(ipi)) %>%
  separate(periodo, into = c("anio", "mes"), sep = "M") %>%
  mutate(
    anio = as.integer(anio),
    mes  = as.integer(mes)
  ) %>%
  select(ccaa, anio, mes, ipi)
```
```{r, echo=FALSE}
knitr::kable(head(ipi_long))
```

Como indicador del **ciclo económico regional**, se incorpora el **Índice de Producción Industrial (IPI)** por comunidad autónoma, normalmente publicado con base 100 por el INE. El IPI resume la evolución de la actividad productiva, y se utiliza aquí como variable de control para capturar el efecto del entorno macroeconómico sobre la demanda turística.

En la base, el IPI se almacena en la columna `ipi`. Al estar medido en índice, valores superiores a 100 indican un nivel de producción por encima del año base, mientras que valores inferiores reflejan fases de desaceleración.


## 2.4. Índice de Precios de Consumo (IPC)
```{r carga_ipc, include=FALSE}
ipc <- read_excel(
  "ipc.xlsx",
  skip  = 8 ,        # salta filas de título; ajusta según veas
  n_max = 20
)

names(ipc)[1] <- "ccaa"
ipc$`2025M11` <- NULL

ipc_2010M01 = ipc$`2010M01`
```
```{r, echo=FALSE}
knitr::kable(head(ipc[, c(1:12)]))
```

El **Índice de Precios de Consumo (IPC)** se emplea exclusivamente como deflactor del ADR. El IPC se toma de las estadísticas oficiales y se mide como un índice con base 100 por comunidad y mes. 


## 2.5. Datos de precios: ADR
```{r carga_adr, include=FALSE}
adr <- read_excel(
  "ADR.xlsx",
  skip  = 7 ,        # salta filas de título; ajusta según veas
  n_max = 19
)

names(adr)[1] <- "ccaa"

# 1) Guardar la columna ccaa
ccaa <- adr[[1]]
# 2) Convertir meses a matriz numérica
adr_m <- as.matrix(adr[ , -1])
ipc_m <- as.matrix(ipc[ , -1])
adr_m <- apply(adr_m, 2, as.numeric)
ipc_m <- apply(ipc_m, 2, as.numeric)
# 3) Calcular ADR_real (elemento a elemento)
adr_real_m <- adr_m * ipc_2010M01 / ipc_m
# 4) Volver a data.frame y añadir ccaa
adr_real <- data.frame(ccaa = ccaa, adr_real_m, check.names = FALSE)


adr_real_long <- adr_real %>%
  mutate(across(-ccaa, as.character)) %>%          # columnas de meses a char
  pivot_longer(
    cols = -ccaa,
    names_to  = "periodo",                         # ej. "2025M10"
    values_to = "adr"
  ) %>%
  mutate(adr = as.numeric(adr)) %>%
  separate(periodo, into = c("anio", "mes"), sep = "M") %>%
  mutate(
    anio = as.integer(anio),
    mes  = as.integer(mes)
  ) %>%
  select(ccaa, anio, mes, adr)
```
```{r, echo=FALSE}
knitr::kable(head(adr_real_long))
```

Como medida del **precio medio por noche**, se utiliza el *Average Daily Rate* (ADR) obtenido a partir de las estadísticas de ocupación hotelera. El ADR recoge la facturación media por habitación ocupada y se interpreta como el precio nominal que pagan los turistas por pernoctar en cada comunidad autónoma y mes. En la base, este valor se almacena en la columna `adr`.

Dado que el ADR está expresado en términos nominales, se construye una versión **deflactada** utilizando el Índice de Precios de Consumo (IPC) regional:
\[
ADR\_real_{it} = \frac{ADR_{it}}{IPC_{it}/100}
\]
De este modo se eliminan las variaciones debidas al nivel general de precios y se obtiene una medida del coste real del alojamiento turístico a lo largo del tiempo que permite analizar la evolución del precio del alojamiento descontando el efecto de la inflación y hacer comparaciones temporales más significativas.


## 2.6. Construcción del panel y variable temporal
```{r creacion_df, include=FALSE}
df <- perno_long |>
  left_join(plazas_long, by = c("ccaa", "anio", "mes")) |>
  left_join(adr_real_long,    by = c("ccaa", "anio", "mes")) |>
  left_join(ipi_long,    by = c("ccaa", "anio", "mes"))

df <- df |>
  mutate(
    # tiempo como año + fracción del año
    fecha_panel = anio + (mes - 1) / 12
  )

df_panel <- pdata.frame(df, index = c("ccaa", "fecha_panel"))

df_panel <- df_panel[
  complete.cases(df_panel[ , c("pernoctaciones", "adr", "plazas", "ipi")]),
]
```
```{r}
knitr::kable(head(df[df$ccaa == '18 Ceuta', ]))
knitr::kable(head(df[df$ccaa == '19 Melilla', ]))
```

A partir de estas fuentes, se ha construido una base integrada `df` en formato de panel, donde cada fila corresponde a una combinación **comunidad autónoma–mes–año**. Además de las columnas de identificación (`ccaa`, `anio`, `mes`), se ha creado una variable temporal continua `fecha_panel` (año fraccionado) para facilitar la representación gráfica y el tratamiento como serie temporal agregada.

Este diseño permite combinar en un mismo conjunto de datos las dimensiones **transversal** (diferencias entre CCAA) y **temporal** (evolución mensual), cumpliendo los requisitos del trabajo para el análisis de datos de panel y series temporales.

Pero, como podemos observar, no existen datos sobre el IPI de Ceuta y Melilla en el INE. Dado que el IPI forma parte de las variables explicativas del modelo de datos de panel, mantener estas observaciones implicaría trabajar con un panel fuertemente incompleto o recurrir a imputaciones ad‑hoc de difícil justificación económica. Por este motivo, se ha optado por eliminar las filas correspondientes a Ceuta y Melilla, de manera que el análisis se centra en las comunidades para las que existe información completa y comparable en todas las variables utilizadas. Esta decisión permite estimar el modelo de efectos fijos sobre un panel más coherente y evita introducir supuestos adicionales sobre la evolución no observada del IPI en estos territorios.

```{r eliminamos_Ceuta_y_Melilla, include=FALSE}
df <- df[df$ccaa != '18 Ceuta', ]
df <- df[df$ccaa != '19 Melilla', ]
```
```{r}
knitr::kable(head(df))
```

Por lo tanto, `df` quedaría de esta manera.



# 3. Análisis descriptivo 
## 3.1. Estadísticos descriptivos

En este apartado, presentamos los estadísticos descriptivos básicos de las principales variables del panel (pernoctaciones, plazas, adr e ipi) con el objetivo de resumir su distribución y tener una primera idea de los niveles y la dispersión del turismo y de sus posibles determinantes.

```{r estadísticos_basicos}
# Estadísticos básicos
summary(df[, c("pernoctaciones", "plazas", "adr", "ipi")])
```

En los estadísticos, podemos observar como **pernoctaciones** y **plazas** presentan medias muy superiores a sus medianas, lo que indica distribuciones claramente asimétricas hacia la derecha: algunos meses y CCAA concentran niveles de demanda y capacidad muy elevados, que empujan la media por encima del “caso típico”. Además, los valores máximos de pernoctaciones (más de 11 millones) y plazas (más de 380 mil) confirman la existencia de observaciones extremas asociadas a destinos turísticos de gran tamaño.

En contraste, **ADR** e **IPI** aparecen mucho más acotados. Sus mínimos y máximos están relativamente próximos y las medianas son muy similares a las medias, lo que sugiere una dispersión moderada y menor asimetría. Esto refleja que los precios medios por noche y la actividad industrial regional varían, pero no alcanzan los niveles de concentración observados en la demanda y la capacidad hotelera.

Por último, la existencia de algunos valores perdidos únicamente en la variable ADR indica que, aunque la información sobre pernoctaciones, plazas e IPI está completa para todos los meses y comunidades, la serie de precios no está observada en todos los casos, por lo que resulta necesario decidir explícitamente cómo tratar estas observaciones incompletas antes de proceder a la estimación econométrica.

```{r valores_na}
df_na_adr <- df[is.na(df$adr), ]
dplyr::count(df_na_adr, anio, mes)
```

Los valores perdidos en ADR se concentran únicamente en dos meses muy concretos: mayo y junio de 2020, con 17 comunidades afectadas en cada uno de ellos. Dado que se trata de un episodio excepcional asociado a la pandemia y que el resto del panel está completamente observado, se ha optado por eliminar estas observaciones al construir el panel para los modelos de datos de panel. Esta decisión reduce mínimamente el tamaño muestral y evita tener que imputar precios en un periodo atípico, lo que podría distorsionar la interpretación econométrica de los resultados.

```{r eliminamos_na}
df <- df[!is.na(df$adr), ]
summary(df[, c("pernoctaciones", "plazas", "adr", "ipi")])
```

Ahora ya podemos observar como no tenemos ningún valor faltante en el panel `df`.

```{r media_y_desviación}
# Media y desviación típica por variable
desc_stats <- df |>
  summarise(
    mean_perno = mean(pernoctaciones, na.rm = TRUE),
    sd_perno   = sd(pernoctaciones, na.rm = TRUE),
    mean_plazas = mean(plazas, na.rm = TRUE),
    sd_plazas   = sd(plazas, na.rm = TRUE),
    mean_adr  = mean(adr, na.rm = TRUE),
    sd_adr    = sd(adr, na.rm = TRUE),
    mean_ipi  = mean(ipi, na.rm = TRUE),
    sd_ipi    = sd(ipi, na.rm = TRUE)
  )
desc_stats

```

Las medias y desviaciones típicas confirman la fuerte heterogeneidad entre observaciones. La **media de pernoctaciones** ronda 1,4 millones con una desviación típica superior a 2 millones, lo que implica una variabilidad muy elevada entre CCAA y meses, coherente con la existencia de destinos muy masivos frente a otros claramente secundarios.

En el caso de **plazas**, la media en torno a 83 mil y la desviación típica cercana a 94 mil apuntan a una dispersión también muy alta en la capacidad de alojamiento, lo que refuerza la idea de que la oferta está muy concentrada en pocas regiones.

Por el contrario, **ADR** e **IPI** presentan medias cercanas a 62 y 101 respectivamente, con desviaciones típicas mucho más contenidas (en torno a 16 para ADR y 13 para IPI). Esto indica que tanto los precios medios del alojamiento como el nivel de actividad industrial muestran variaciones relevantes pero relativamente moderadas en comparación con la enorme dispersión observada en la demanda y la capacidad hotelera.


## 3.2. Gráficos descriptivos
### 3.2.1. Evolución agregada de las pernoctaciones

Ahora, vamos a representar la suma mensual de pernoctaciones a nivel nacional con el fin de identificar tendencias de largo plazo, patrones estacionales y posibles rupturas estructurales en la serie.

```{r evolución_perno}
ggplot(df, aes(x = fecha_panel, y = pernoctaciones)) +
  stat_summary(fun = sum, geom = "line") +
  labs(x = "Tiempo", y = "Pernoctaciones totales", 
       title = "Evolución de las pernoctaciones (total España)")
```

Según lo que podemos llegar a observar, la serie agregada muestra un comportamiento claramente estacional, con picos muy pronunciados en los meses de verano y mínimos en temporada baja, sobre una tendencia creciente en el período analizado. Destaca una fuerte caída en 2020, seguida de una recuperación gradual, coherente con el impacto de la pandemia sobre la actividad turística.

### 3.2.2. Evolución de las pernoctaciones por CCAA

A continuación se representan las pernoctaciones por comunidad autónoma mediante gráficos de líneas facetados. Esto permite comparar la dinámica temporal entre regiones y detectar diferencias estructurales en niveles y patrones de estacionalidad.

```{r perno_por_CCAA}
ggplot(df, aes(x = fecha_panel, y = pernoctaciones)) +
  geom_line() +
  facet_wrap(~ ccaa) +
  labs(x = "Tiempo", y = "Pernoctaciones",
       title = "Pernoctaciones por CCAA en el tiempo")
```

Las series regionales confirman una elevada concentración del turismo en Baleares, Canarias, Cataluña, Comunidad Valenciana y Andalucía, que presentan niveles muy superiores al resto y ciclos estacionales bien definidos. Otras regiones, como La Rioja, Navarra, Ceuta o Melilla, muestran volúmenes de pernoctaciones mucho más reducidos y, en algunos casos, mayor volatilidad relativa, lo que apunta a estructuras turísticas menos consolidadas


### 3.2.3. Distribución de pernoctaciones por CCAA

Utilizamos ahora diagramas de caja de pernoctaciones por comunidad autónoma para analizar la distribución de la actividad turística dentro de cada región, identificando la mediana, la dispersión y la presencia de observaciones extremas.

```{r histograma_perno}
ggplot(df, aes(x = pernoctaciones)) + 
  geom_histogram(bins = 30) +
  labs(title = "Distribución de pernoctaciones")
```

Podemos observar una distribución de pernoctaciones muy asimétrica a la derecha ya que la mayoría de observaciones se concentran en valores bajos cercanos a 0, y a medida que aumentan las pernoctaciones la frecuencia cae rápidamente, quedando pocas observaciones con valores muy altos. Esto sugiere presencia de valores extremos y una fuerte cola derecha, por lo que transformaciones como el logaritmo podrían ser útiles para el análisis.

```{r boxplot_perno_CCAA}
ggplot(df, aes(x = ccaa, y = pernoctaciones)) +
  geom_boxplot() +
  coord_flip()

```

Por otro lado, el diagrama de cajas por CCAA muestra que las pernoctaciones son muy heterogéneas entre regiones. Baleares, Cataluña y Comunitat Valenciana concentran los niveles más altos y con mayor dispersión, mientras que regiones como La Rioja, Navarra o Cantabria presentan volúmenes mucho menores y rangos intercuartílicos muy estrechos. Además, se observan valores atípicos altos en varias comunidades, lo que refuerza la idea de una distribución muy sesgada y con episodios puntuales de demanda turística extrema.


## 3.3. Matriz de correlaciones

Por último, se calcula la matriz de correlaciones entre pernoctaciones y las variables explicativas (plazas, adr e ipi). El objetivo es explorar las relaciones lineales bivariantes y valorar la posible existencia de multicolinealidad previa a la estimación del modelo de datos de panel.

```{r}
vars_cor <- df |> 
  select(pernoctaciones, plazas, adr, ipi)

cor_matrix <- cor(vars_cor, use = "pairwise.complete.obs")
cor_matrix

cor_long <- melt(cor_matrix)
ggplot(cor_long, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(limits = c(-1,1)) +
  labs(x = "", y = "", fill = "Correlación")
```

Las pernoctaciones están fuertemente correlacionadas con las plazas (correlación superior a 0,95), lo que subraya la importancia de la capacidad de alojamiento, pero también sugiere un posible problema de multicolinealidad al incluir ambas variables en la misma especificación. La correlación entre pernoctaciones y adr es positiva y de magnitud media (en torno a 0,66), indicando que los destinos más demandados tienden a asociarse con precios más elevados, posiblemente por mayor calidad o presión de demanda. La relación con el ipi es positiva pero más moderada, en torno a 0,34, lo que apunta a que el ciclo económico influye en el turismo, aunque en menor medida que la capacidad y los precios.



# 4. Modelo económico de datos de panel
## 4.1. Formulación de la pregunta de interés

La pregunta en la que nos vamos a centrar es: 

**¿Cómo afectan el precio real (ADR deflactado), la capacidad hotelera (plazas) y la renta disponible (IPI) a la demanda turística (pernoctaciones) en las CCAA españolas?**

Se espera: 

  - Elasticidad-precio negativa: ($\beta_1<0$) 
  - Efecto oferta positivo: ($\beta_2>0$) 
  - Mayor demanda con mejor ciclo económico: ($\beta_3>0$)

## 4.2. Modelo teórico

$$Pernoctaciones_{it} = \beta_0 + \beta_1 \cdot ADR_{real,it} + \beta_2 \cdot Plazas_{it} + \beta_3 \cdot IPI_{it} + \sum_{m=2}^{12} \delta_m \cdot DummyMes_m + \alpha_i + \epsilon_{it}$$
Donde $\alpha_i$ captura heterogeneidad territorial no observada (preferencias, clima, accesibilidad).


## 4.3. Especificación econométrica
### 4.3.1. Variable dependiente y explicativas

- **Pernoctaciones totales**: miden el volumen de demanda turística agregado en cada observación, y actúan como variable dependiente del modelo.
- **ADR real**: cociente entre el ADR nominal y el índice de precios al consumo \((\text{IPC}/100)\); recoge el precio medio por habitación ajustado por inflación, es decir, el coste “en términos reales” para el cliente.
- **Plazas estimadas**: aproximan la capacidad de oferta alojativa disponible en cada región y período, permitiendo capturar restricciones o ampliaciones de capacidad.
- **IPI general**: índice de producción industrial utilizado como proxy del ciclo económico y de la renta disponible regional, que afecta al nivel de gasto turístico.
- **Dummies mensuales**: variables ficticias que identifican cada mes del año y permiten controlar la estacionalidad fija de la demanda (picos de verano, Semana Santa, etc.).

### 4.3.2. Transformaciones (logs, ADR real, etc.)

- **ADR real**: el precio medio por habitación se deflacta dividiendo el ADR nominal entre el índice de precios al consumo \((\text{IPC}/100)\), de forma que el modelo trabaja siempre con precios constantes y hace comparables periodos con distinta inflación.
- **Panel desbalanceado por CCAA**: la información se organiza como un panel regional de 17 comunidades autónomas con frecuencia mensual, pero algunas combinaciones CCAA–mes carecen de datos, por lo que el conjunto resulta ser un panel desbalanceado en lugar de completamente equilibrado.


# 5. Estimación de modelos de panel

La siguiente sección presenta la estimación empírica del modelo de demanda de pernoctaciones utilizando técnicas de datos de panel. Concretamente, compararemos cual es el mejor modelo que responde a nuestra pregunta de interés entre los modelos **pooled OLS**, **efectos fijos** y **efectos aleatorios**.

## 5.1. Modelo pooled OLS

En primer lugar, se parte de un modelo **pooled OLS**, que trata todas las observaciones del panel como si procedieran de una única muestra transversal, ignorando la heterogeneidad específica de cada comunidad autónoma y de cada periodo temporal. Este modelo inicial sirve como punto de referencia para evaluar posteriormente la conveniencia de incorporar efectos individuales (fijos o aleatorios) y comparar el ajuste y la significatividad de las variables explicativas frente a especificaciones más complejas.


```{r modelo_pooled}
mod.pool <- plm(pernoctaciones ~ adr + plazas + ipi + factor(mes),
              data = df, index = c("ccaa", "fecha_panel"), model = "pooling")
summary(mod.pool)
```

Los resultados muestran un **excelente ajuste global** (R² = 0.935, F = 3285.32, p<2.22e-16), explicando el 93.5% de la variabilidad de las pernoctaciones.

En cuanto a los coeficientes principales, estos son estadísticamente significativos:

- **ADR** ($\hat{\beta}_{ADR} = 8,948$): Un incremento de 1€ en el precio medio por noche se asocia con **+8,948 pernoctaciones adicionales**, resultado **contraintuitivo** que sugiere que regiones más atractivas tienen mayor ADR y demanda simultáneamente.

- **Plazas** ($\hat{\beta}_{plazas} = 19.97$): Cada plaza hotelera adicional genera **~20 pernoctaciones** adicionales, reflejando el **dominio estructural de la oferta**.

- **IPI** ($\hat{\beta}_{IPI} = 12,36$): Un punto más en el índice industrial se asocia con **+12,36 pernoctaciones**, confirmando el rol procíclico del turismo.

Las **dummies mensuales** capturan la fuerte estacionalidad, destacando **agosto** ($\hat{\delta}_8 = 830,17$) como mes pico.

**Limitación principal**: El modelo *pooled* asume homogeneidad entre CCAA, ignorando heterogeneidad territorial no observada ($\alpha_i$).

## 5.2. Modelo de efectos fijos

En segundo lugar, se estima un modelo de **efectos fijos** que permite capturar la heterogeneidad inobservable específica de cada comunidad autónoma, asumiendo que dichas características son constantes en el tiempo pero potencialmente correlacionadas con las variables explicativas incluidas en la regresión. Bajo esta especificación, la identificación de los coeficientes se basa en la variación temporal dentro de cada CCAA, de modo que se depuran los efectos estructurales propios de cada región y se obtiene una medida más robusta del impacto del ADR real, la capacidad de plazas y el ciclo económico sobre las pernoctaciones.

```{r modelo_ef}
mod.ef <- plm(pernoctaciones ~ adr + plazas + ipi + factor(mes),
          data = df, index = c("ccaa", "fecha_panel"), model = "within")

summary(mod.ef)
```

El modelo conserva un **excelente poder explicativo** (R² = 0.927, F = 2856.64, p<2.22e-16).

En cuanto a los coeficientes, estos muestran **tres cambios notables** respecto al pooled OLS:

- **ADR** ($\hat{\beta}_{ADR} = 4,848$): Reduce un **46%** su magnitud pero **mantiene signo positivo** significativo, sugiriendo que regiones con precios relativamente altos atraen más turistas.

- **Plazas** ($\hat{\beta}_{plazas} = 26.93$): **Aumenta 35%** su efecto, confirmando que la capacidad hotelera es el **driver dominante** de la demanda turística.

- **IPI** ($\hat{\beta}_{IPI} = 2,573$): **Reduce drásticamente** (79%) tras controlar heterogeneidad, pero confirma **carácter procíclico** del turismo.

La **estacionalidad** se mantiene con **agosto** como pico dominante ($\hat{\delta}_8 = 503,43$).

**Limitación persistente**: El **ADR positivo** inesperado sugiere que regiones de calidad superior cobran más Y atraen más turistas.

## 5.3. Modelo de efectos aleatorios

Por último, se ha estimado un modelo de efectos aleatorios con la misma especificación. Este enfoque asume que las diferencias no observadas entre comunidades autónomas son aleatorias e incorreladas con las variables explicativas, lo que permite aprovechar tanto la variación entre territorios como la variación temporal.

```{r modelo_ea}
mod.ea <- plm(pernoctaciones ~ adr + plazas + ipi,
          data = df, index = c("ccaa", "fecha_panel"), model = "random")

summary(mod.ea)
```

El modelo de **efectos aleatorios** modeliza la heterogeneidad territorial ($\alpha_i$) como componente aleatorio, aplicando transformación GLS óptima ($\theta = 0.910$). Conserva **excelente poder explicativo** (R² = 0.914, $\chi^2 = 33,955$, $p<2.2e^{-16}$).

Los coeficientes **difieren notablemente** de efectos fijos, revelando inconsistencias que cuestionan la validez del supuesto RE:

- **ADR** ($\hat{\beta}_{ADR} = 10,113$): **Duplica** su magnitud (+110% vs EF ~4,817), manteniendo signo positivo **robusto** ($z=16.05$, $p<2.2e^{-16}$), pero magnitud sesgada al alza por omitir correlación territorial.

- **Plazas** ($\hat{\beta}_{plazas} = 26.97$): **Dominio absoluto** confirmado (+1% vs EF), con $z=155.22$ que valida su rol estructural esencial.

- **IPI** ($\hat{\beta}_{IPI} = -2,131$): **Signo opuesto** drástico (negativo significativo $z=-3.46$, $p=0.0005$ vs positivo en EF), señal de **endogeneidad severa** capturada solo por EF.

**Implicación clave**: Diferencias sustanciales (especialmente IPI) sugieren fuerte correlación efectos-regresoras. El **test de Hausman** (`phtest(mod.ef, mod.ea)`) confirmará preferencia por EF como consistente.


## 5.4. Comparación de modelos

Comparamos ahora los 3 modelos obtenidos.

### 5.4.1. Test F (EF vs pooled)

```{r test_F}
pFtest(mod.ef, mod.pool)
```

El test F de efectos individuales contrasta el modelo pooled frente al modelo con efectos fijos por comunidad autónoma. El estadístico F = 280.91 (p‑valor < 0.001) permite rechazar claramente la hipótesis nula de ausencia de efectos individuales. Por tanto, la heterogeneidad no observada entre CCAA es estadísticamente relevante y el modelo pooled resulta inadecuado. En consecuencia, el modelo de **efectos fijos** es preferible al modelo agrupado para explicar las pernoctaciones turísticas.

### 5.4.2. Test de Hausman (EF vs EA)

```{r test_Hausman}
phtest(mod.ef, mod.ea)
```

El test de Hausman compara estimaciones de **efectos fijos** (consistentes) vs **efectos aleatorios** (potencialmente sesgados). El estadístico **χ² = 408.18** (df=3, **p-valor < 2.2e-16**) rechaza H₀: ambos estimadores consistentes.

Esto confirma **correlación** entre efectos individuales y regresoras (especialmente IPI), violando supuesto EA. Por tanto, el modelo de **efectos fijos** es la **especificación preferida**.

## 5.5. Diagnóstico del modelo de efectos fijos
### 5.5.1. Errores robustos a heteroscedasticidad y autocorrelación

Se calculan errores estándar robustos clustered por CCAA (Arellano) para corregir heteroscedasticidad y autocorrelación serial:

```{r heterocedasticidad_y_autocorrelacion}
# test heterocedasticidad (tipo Breusch–Pagan sobre EF)
bptest(mod.ef)

# test autocorrelación en panel (Wooldridge)
pwfdtest(pernoctaciones ~ adr + plazas + ipi + factor(mes),
         data = df, index = c("ccaa","fecha_panel"))
```

Dado que trabajamos con un panel mensual por CCAA, es razonable sospechar la presencia de heterocedasticidad y autocorrelación en los residuos. Para comprobarlo, se aplicaron contrastes específicos sobre el modelo de efectos fijos: el test de Breusch–Pagan detecta **heterocedasticidad significativa**, mientras que el test de Wooldridge no encuentra evidencia de **autocorrelación serial** en los errores. En consecuencia, los supuestos de varianza constante no se cumplen, por lo que la inferencia basada en errores estándar convencionales podría ser poco fiable. Este problema se corrige reestimando los errores estándar mediante varianzas robustas agrupadas por comunidad autónoma (tipo Arellano).

### 5.5.2. Corrección con errores robustos

```{r corrección_errores_robustos}
# errores robustos tipo Arellano (cluster por CCAA)
vcov_rob <- vcovHC(mod.ef, method = "arellano", type = "HC0", cluster = "group")
res_rob  <- coeftest(mod.ef, vcov = vcov_rob)
res_rob
```

Tras aplicar la corrección robusta, los coeficientes puntuales del modelo se mantienen prácticamente inalterados, pero aumentan sus errores estándar. En particular, la significatividad de las variables clave cambia parcialmente: la variable de plazas sigue siendo altamente significativa, mientras que el ADR y el IPI pierden significación al 5 % (aunque conservan el signo esperado). Por tanto, el modelo de efectos fijos con errores estándar robustos se considera la especificación más adecuada para el análisis, ya que ofrece inferencias válidas en presencia de heterocedasticidad.


# 6. Estimador de diferencias en diferencias

Con el modelo de efectos fijos ya validado, se extiende el análisis para identificar un efecto causal asociado a una intervención específica mediante el estimador de diferencias en diferencias (DiD). Para ello, se define un grupo tratado (CCAA potencialmente más afectadas por la medida) y un periodo posterior a la intervención.

```{r DiD}
df$treat <- ifelse(df$ccaa %in% c("Andalucía","Illes Balears","Canarias",
"Cataluña","Comunidad Valenciana"), 1, 0)
df$post <- ifelse(df$fecha_panel >= as.Date("2020-07-01"), 1, 0)
df$did <- df$treat * df$post

mod.did <- plm(pernoctaciones ~ adr + plazas + ipi + did + factor(mes),
data = df, index = c("ccaa","fecha_panel"), model = "within")
summary(mod.did)
```

El parámetro de interés es el coeficiente de la interacción **did**, que mide el cambio adicional en pernoctaciones del grupo tratado en el periodo posterior respecto al grupo de control y al periodo previo, una vez controlados los efectos fijos por CCAA, la estacionalidad mensual y las variables de control (ADR, plazas e IPI). Si dicho coeficiente resulta estadísticamente significativo, puede interpretarse como el efecto causal aproximado de la intervención sobre las pernoctaciones en las regiones turísticas.

La especificación de **diferencias en diferencias** sobre el modelo de **efectos fijos** presenta un ajuste excelente (R² = 0.927, F = 2856.6, p < 2.2e-16). Los coeficientes de las variables de control se mantienen muy estables: el ADR real conserva un efecto positivo y significativo sobre las pernoctaciones ($\hat{\beta}_{ADR} = 4{,}848$), las plazas vuelven a mostrar un impacto estructural dominante ($\hat{\beta}_{plazas} = 26.93$) y el IPI mantiene un efecto procíclico positivo y significativo ($\hat{\beta}_{IPI} = 2{,}573$).

En cambio, el coeficiente asociado a la interacción de **diferencias en diferencias** no resulta significativo en esta especificación, lo que sugiere que, una vez controladas las diferencias fijas entre CCAA, la estacionalidad mensual y las variables de control, no se identifica un efecto adicional claro de la intervención sobre las pernoctaciones turísticas. El modelo **DiD** sirve, por tanto, como contraste de robustez: confirma la estabilidad de los efectos de ADR, plazas e IPI, pero no aporta evidencia concluyente de un cambio estructural específico ligado al tratamiento considerado.

Por lo tanto, concluímos que el modelo de **efectos fijos**, estimado con errores estándar robustos agrupados, es la especificación más adecuada para analizar las pernoctaciones turísticas por CCAA. En este marco, las plazas actúan como determinante estructural principal, mientras que ADR e IPI muestran efectos positivos coherentes con el ciclo económico, y la extensión de diferencias en diferencias no revela un impacto adicional claramente atribuible al tratamiento considerado.


# 7. Interpretación de resultados de panel
## 7.1. Efectos de plazas, ADR real e IPI

El modelo de **efectos fijos** con errores estándar robustos muestra que las **plazas** son el principal determinante de las **pernoctaciones**: el coeficiente estimado en torno a 27 implica que un aumento de una plaza se asocia, en promedio, con unas 27 pernoctaciones adicionales al mes en la misma CCAA, manteniendo constantes el resto de factores.

El **ADR real** presenta un coeficiente positivo y significativo en la especificación principal, lo que indica que, dentro de cada comunidad, los periodos con precios medios más elevados tienden a coincidir con mayores niveles de demanda, probablemente por la coincidencia con temporadas altas. Por su parte, el **IPI** actúa como indicador del ciclo económico ya que su efecto positivo sugiere que, en fases expansivas, el incremento de la actividad industrial se acompaña de un aumento de las pernoctaciones turísticas.

## 7.2. Discusión económica de los coeficientes

Desde el punto de vista económico, el fuerte impacto de las **plazas** refleja el carácter esencialmente **ofertista y estructural** del turismo regional: las CCAA con mayor capacidad alojativa concentran de forma persistente más **pernoctaciones**, incluso tras controlar por diferencias fijas y estacionalidad. El papel del **ADR** es coherente con un mercado donde los precios más altos no reducen la demanda, sino que señalan periodos de alta ocupación y mayor disposición a pagar por parte de los turistas.

El efecto procíclico del **IPI** indica que la actividad turística se beneficia de un entorno macroeconómico favorable ya que cuando la economía real se expande, aumenta el poder adquisitivo y se incrementan las estancias turísticas. En conjunto, los resultados sugieren que la política económica que busque potenciar el turismo debería considerar tanto la expansión de la capacidad alojativa como el entorno macroeconómico general, mientras que las variaciones en precios parecen más una consecuencia de la presión de demanda que un instrumento activo de gestión.


# 8. Análisis de series temporales

Ahora que se ha caracterizado la heterogeneidad territorial mediante modelos de datos de panel, el siguiente paso consiste en estudiar la dinámica temporal agregada de la demanda turística. Para ello se selecciona una serie mensual de pernoctaciones que sirva como indicador sintético de la evolución del turismo y que permita analizar tendencia, estacionalidad y posibles cambios estructurales, además de construir modelos de pronóstico.

## 8.1. Selección de la serie (por ejemplo, pernoctaciones totales)

Para el análisis de series temporales se trabaja con la serie mensual de pernoctaciones turísticas totales en España, obtenida agregando las pernoctaciones de todas las CCAA y todos los tipos de establecimiento. Esta serie proporciona una medida sintética de la evolución global de la demanda turística y es coherente con el análisis previo de panel, donde se analizaron los determinantes de las pernoctaciones a nivel regional. A partir de esta serie agregada se llevará a cabo la exploración gráfica, la descomposición en tendencia y estacionalidad, las pruebas de estacionariedad y la posterior modelización con herramientas de pronóstico.

```{r serie_temporal}
perno_esp <- perno_long |>
  group_by(anio, mes) |>
  summarise(pernoct_total = sum(pernoctaciones), .groups = "drop") |>
  arrange(anio, mes)

ts_pernoct <- ts(perno_esp$pernoct_total,
                 start = c(min(perno_esp$anio), min(perno_esp$mes)),
                 frequency = 12)

ts_pernoct <- na.interp(ts_pernoct)

ts_pernoct
```

Los valores de mayo y junio de 2020 se imputan mediante interpolación temporal para evitar problemas técnicos en la descomposición y la estimación de modelos ARIMA, sin que ello afecte a la interpretación cualitativa del shock de 2020

## 8.2. Exploración y descomposición

Antes de especificar un modelo de pronóstico, se realiza una exploración descriptiva de la serie mensual de pernoctaciones totales. En primer lugar, se representa la serie completa en forma de gráfico temporal para detectar visualmente la presencia de tendencia, patrones estacionales marcados y posibles cambios estructurales asociados a la crisis de 2020 u otros episodios relevantes. A continuación, se aplica una descomposición clásica de la serie en sus componentes de tendencia-ciclo, estacionalidad y componente irregular, lo que permite evaluar si la estacionalidad es estable en el tiempo y si la tendencia sigue una evolución suave o presenta rupturas bruscas.

```{r exploración_ts}
# serie mensual agregada (suponiendo ts_pernoct es un objeto ts)
autoplot(ts_pernoct) +
  labs(x = "Año", y = "Pernoctaciones", 
       title = "Serie mensual de pernoctaciones totales")
```

La **serie mensual de pernoctaciones totales** muestra una **fuerte estacionalidad**, con picos muy marcados en los meses de verano y mínimos recurrentes en invierno. Además, se aprecia una **tendencia suavemente creciente** en el periodo previo a 2020, interrumpida por un **colapso abrupto** durante la crisis de la COVID‑19, tras el cual la serie **recupera progresivamente** sus niveles anteriores manteniendo el patrón estacional.

```{r descomposición_ts}
# descomposición clásica aditiva
descomp <- decompose(ts_pernoct, type = "additive")
autoplot(descomp)
```

Se representa la serie mensual de pernoctaciones y se realiza una descomposición aditiva en tendencia‑ciclo, estacionalidad y componente irregular, a fin de analizar su comportamiento a lo largo del tiempo.

### 8.2.1. Tendencia, ciclo y estacionalidad

La descomposición aditiva confirma claramente la estructura de la serie. El componente de **tendencia** muestra un crecimiento suave y sostenido de las pernoctaciones hasta 2019, seguido de un hundimiento brusco en 2020 y una posterior recuperación gradual hacia niveles cercanos a los previos a la crisis. 

El componente **estacional** presenta un patrón muy regular y estable en todo el periodo, con máximos concentrados en los meses de verano y mínimos en invierno, lo que refleja la fuerte estacionalidad del turismo. El componente **irregular** concentra las oscilaciones de corto plazo y recoge especialmente los movimientos extremos asociados al shock de 2020.

Esto se puede ver claramente en el gráfico anterior.

## 8.3. Transformaciones y estacionariedad

Para la **modelización de series temporales** es conveniente trabajar con una **serie aproximadamente estacionaria en media** y con una **variabilidad más estable**. Dado que las pernoctaciones son estrictamente positivas y presentan una tendencia clara, se utilizará el **logaritmo** de la serie mensual de pernoctaciones, manteniendo la frecuencia mensual.

La inspección gráfica de la serie en niveles muestra una **tendencia creciente** y una **estacionalidad marcada**, por lo que no puede considerarse estacionaria. En consecuencia, el grado de diferenciación necesario para eliminar dicha tendencia y alcanzar la estacionariedad se determinará en la fase de modelización, cuando se ajusten modelos ARIMA sobre la serie transformada en logaritmos.


```{r tranformación_logarítmica}
ts_log <- log(ts_pernoct)
ts_log[124] <- NA
ts_log    <- na.interp(ts_log)

autoplot(ts_log)
```

La transformación logarítmica estabiliza la variabilidad creciente de la serie original y facilita la modelización posterior.

## 8.4. Modelización con `forecast`

Modelizamos ahora la serie de pernoctaciones utilizando el paquete `forecast`. Tras la **transformación logarítmica** y la **descomposición previa**, disponemos de una serie aproximadamente estacionaria, con estacionalidad regular y residuos sin patrones claros, lo que la hace adecuada para ajustar modelos lineales con tendencia y estacionalidad, así como modelos **ARIMA y ETS**. El objetivo es obtener pronósticos coherentes a corto plazo y comparar su precisión mediante métricas como **RMSE y MAPE**, trabajando siempre en la escala logarítmica y, posteriormente, devolviendo los resultados a la escala original para su interpretación económica.

### 8.4.1. Modelos ARIMA/ETS

Ajustamos primero un modelo de tendencia + estacionalidad sobre ts_log

```{r ajuste_log_ts}
mod_tslm <- tslm(ts_log ~ trend + season)
fc_tslm <- forecast(mod_tslm, h = 8)
autoplot(fc_tslm)
```

El ajuste del modelo de regresión lineal con tendencia y estacionalidad sobre la serie transformada en logaritmos reproduce adecuadamente el patrón histórico de las pernoctaciones, incluidos el shock de 2020 y la posterior recuperación. Los pronósticos a dos años vista muestran un crecimiento moderado con fuerte componente estacional y bandas de confianza crecientes, coherentes con la incertidumbre a medida que nos alejamos del último dato observado.

Ajustamos ahora un modelo ARIMA/ETS automático sobre ts_log

```{r modelización_ts}
mod_arima <- auto.arima(ts_log)
fc_arima <- forecast(mod_arima, h = 8)
autoplot(fc_arima)
accuracy(fc_tslm)
accuracy(fc_arima)
```
El modelo **ARIMA** seleccionado para ts_log mejora sustancialmente el ajuste frente al **modelo de regresión** con tendencia y estacionalidad. Mientras que el **modelo lineal** obtiene un RMSE de 0,44 y un MAE de 0,25 en la escala logarítmica, el **ARIMA** reduce estos valores a 0,13 y 0,07, respectivamente, lo que supone una disminución notable del error medio de pronóstico. Además, el coeficiente de autocorrelación de los residuos en el primer retardo es prácticamente nulo, lo que sugiere que el modelo ha capturado adecuadamente la dependencia temporal de la serie y que los residuos se comportan como ruido blanco.

Vamos a observar que información obtenemos a partir de los residuos del modelo.

```{r residuos}
checkresiduals(mod_arima)
```

El modelo ARIMA seleccionado reduce notablemente el error de pronóstico, pero el contraste de Ljung‑Box (Q=32.0; p‑valor=0.015) indica que aún queda algo de autocorrelación en los residuos, por lo que estos no se comportan como ruido blanco perfecto. Este resultado es coherente con la presencia de episodios atípicos en la serie (por ejemplo, el desplome de 2020), difíciles de capturar completamente con un modelo lineal.


### 8.4.2. Selección de modelo

Para seleccionar el modelo de pronóstico se compararon, sobre la serie transformada en logaritmos, la **regresión con tendencia y estacionalidad** y un **modelo ARIMA estacional**. El ARIMA obtiene valores de **RMSE y MAE** muy inferiores a los del modelo lineal, lo que indica un mejor ajuste de la dinámica de las pernoctaciones. El análisis de residuos muestra una distribución aproximadamente simétrica y centrada en cero, aunque el contraste de Ljung‑Box sugiere que persiste cierta autocorrelación residual, asociada probablemente a los episodios atípicos de 2020. A pesar de esta limitación, se considera que el **ARIMA ofrece el compromiso más adecuado** entre parsimonia y capacidad predictiva, por lo que se utilizará para generar los pronósticos que se presentan a continuación.


# 9. Evaluación de pronósticos

La **evaluación de modelos de pronóstico** mediante partición train/test fija presenta limitaciones, ya que no simula condiciones reales de forecasting donde se actualizan progresivamente los datos disponibles. Para superar esta restricción, se implementa **validación cruzada temporal (tsCV)** siguiendo el procedimiento de ventana deslizante descrito en L6 del material de laboratorio.

## 9.1. Diseño de la ventana deslizante

Este método entrena el modelo en una ventana móvil inicial de 60 observaciones (5 años mensuales) y genera pronósticos para un horizonte h=12 meses (1 año completo, coherente con la estacionalidad turística). Posteriormente, avanza una observación, reestima y repite hasta agotar la muestra, proporcionando una medida robusta del error out-of-sample medio.

```{r ventana_deslizante}
h <- 12                    # Horizonte anual (captura estacionalidad completa)
ts_log_cv <- tsCV(ts_log, 
                  function(y, h) { forecast(mod_arima, h = h) }, 
                  h = h, window = 60)
```


## 9.2. Métricas de error (MAE, RMSE, etc.)

```{r metricas_error}
rmse_cv <- sqrt(mean(ts_log_cv^2, na.rm = TRUE))
mae_cv <- mean(abs(ts_log_cv), na.rm = TRUE)
resultados_cv <- data.frame(
  Modelo = "ARIMA",
  RMSE = round(rmse_cv, 4),
  MAE = round(mae_cv, 4)
)
knitr::kable(resultados_cv, caption = "Error de pronóstico out-of-sample (ventana deslizante)")
```

La **validación cruzada temporal con ventana deslizante** (h = 12) muestra que el modelo ARIMA presenta un error cuadrático medio de predicción **(RMSE)** de 0,8223 y un error absoluto medio **(MAE)** de 0,6002 en la escala logarítmica. Estos valores reflejan una capacidad predictiva adecuada teniendo en cuenta la fuerte estacionalidad y el impacto extraordinario de la pandemia sobre la serie de pernoctaciones mensuales.

## 9.3. Comparación de modelos de pronóstico

Para validar la superioridad del modelo ARIMA frente a alternativas lineales, se compara con tslm(y ~ trend + season) mediante la misma metodología tsCV:

```{r comparación_mod_pronostico}
tslm_cv <- tsCV(ts_log, 
                function(y, h) { forecast(tslm(y ~ trend + season), h = h) }, 
                h = h, window = 60)
rmse_tslm <- sqrt(mean(tslm_cv^2, na.rm = TRUE))
mae_tslm <- mean(abs(tslm_cv), na.rm = TRUE)

comparacion <- data.frame(
  Modelo = c("ARIMA", "tslm"),
  RMSE = round(c(rmse_cv, rmse_tslm), 4),
  MAE = round(c(mae_cv, mae_tslm), 4)
)
knitr::kable(comparacion, caption = "Comparación de errores out-of-sample")
```

La validación cruzada con ventana deslizante (h = 12) muestra que el modelo tslm obtiene **errores de pronóstico out‑of‑sample** (RMSE = 0,7545; MAE = 0,5015) inferiores a los del modelo ARIMA (RMSE = 0,8223; MAE = 0,6002). Por tanto, el **modelo lineal con tendencia y estacionalidad resulta más preciso** para predecir las pernoctaciones mensuales, pese a la mayor flexibilidad teórica del ARIMA.


# 10. Pronóstico final e interpretación

En esta apartado se presenta el **pronóstico de pernoctaciones mensuales** a partir del último dato disponible, utilizando el modelo que ha mostrado mejor desempeño out‑of‑sample en la validación cruzada temporal (tslm frente a ARIMA, según la comparación de RMSE y MAE).

## 10.1. Gráficos de pronóstico con bandas de confianza

El **pronóstico** se obtiene aplicando la **función de predicción correspondiente** sobre la serie transformada y extendiendo la serie 24 meses por delante, lo que permite cubrir dos ciclos turísticos completos (dos veranos y dos inviernos). El resultado se representa mediante un gráfico donde:

- La línea continua recoge los **valores observados de pernoctaciones**.
- La línea discontinua muestra la **trayectoria prevista** por el modelo para los meses futuros.
- Las bandas sombreadas corresponden a los **intervalos de predicción**, generalmente al 80% y 95% de confianza, que cuantifican la incertidumbre en torno al escenario central de pronóstico.

```{r pronóstico}
fc_final <- forecast(mod_tslm, h = 24, level = c(80, 95))

autoplot(fc_final) +
  labs(
    title = "Pronóstico de pernoctaciones mensuales en España",
    x = "Año",
    y = "Pernoctaciones"
  )
```

El pronóstico a 24 meses **preserva el patrón estacional** de la serie, con picos de pernoctaciones en los meses de verano y mínimos en invierno. Tras el desplome de 2020, el modelo proyecta una **recuperación** que sitúa las pernoctaciones futuras en niveles similares o ligeramente superiores a los máximos pre‑pandemia. Las bandas de predicción al 80% y 95% se ensanchan a medida que aumenta el horizonte, lo que refleja una **incertidumbre creciente** y la **posibilidad de que nuevos shocks macroeconómicos o sanitarios** desvíen la demanda respecto al escenario central.

## 10.2. Lectura económica de los resultados

Para la **planificación turística**, estos resultados sugieren que la política pública **debería seguir dimensionando recursos** (capacidad, personal, infraestructuras) en torno a la marcada concentración de la demanda en los meses de verano. Al mismo tiempo, la amplitud de los intervalos de confianza aconseja **mantener cierto margen de flexibilidad**, ya que episodios inesperados pueden reducir significativamente las pernoctaciones respecto a lo previsto.


# 11. Conclusiones
## 11.1. Resumen de hallazgos del panel

El análisis de datos de panel muestra que la **capacidad alojativa** es el principal determinante de la demanda turística: el coeficiente de plazas indica que las comunidades con mayor número de plazas concentran de forma sistemática más pernoctaciones, incluso tras controlar por estacionalidad y heterogeneidad fija regional. por otro lado, el **ADR real** presenta un efecto positivo, coherente con un contexto donde los precios más altos se asocian a destinos de mayor calidad y a temporadas de alta demanda, de modo que el precio refleja en parte la presión de la demanda más que un instrumento activo de racionamiento. Además, el **IPI** actúa como indicador del ciclo económico ya que su signo positivo en el modelo de efectos fijos confirma el carácter procíclico del turismo, con más pernoctaciones en fases expansivas.

Los contrastes de especificación apoyan claramente el uso de un **modelo de efectos fijos** debido a que el test F rechaza el modelo pooled y el test de Hausman descarta la validez de los efectos aleatorios, evidenciando que la heterogeneidad no observada por comunidad está correlacionada con las variables explicativas. Tras corregir por heterocedasticidad con errores estándar robustos agrupados por CCAA, las conclusiones cualitativas se mantienen, reforzando la robustez de los resultados.

## 11.2. Resumen de resultados de series temporales

En cuanto a la serie mensual agregada de pernoctaciones para España, esta presenta una **tendencia suavemente creciente** hasta 2019, un derrumbe brusco en 2020 y una posterior recuperación, junto con un patrón de **estacionalidad muy marcado y estable** con picos en verano. La descomposición aditiva permite separar claramente tendencia, estacionalidad y componente irregular, mostrando que gran parte de la variación se explica por estos dos primeros componentes.

En la comparación de modelos de pronóstico, la validación cruzada temporal con ventana deslizante indica que el modelo **tslm con tendencia y estacionalidad determinista** proporciona errores de pronóstico out‑of‑sample (RMSE y MAE) inferiores a los del modelo ARIMA, pese a que este último es más flexible. El pronóstico a 24 meses preserva la estructura estacional y proyecta una continuación de la recuperación hacia niveles similares o algo superiores a los máximos pre‑pandemia, aunque con bandas de confianza que se ensanchan con el horizonte, reflejando la incertidumbre sobre shocks futuros

## 11.3. Limitaciones y posibles extensiones

Por último, el trabajo presenta varias **limitaciones**. En primer lugar, el panel excluye Ceuta y Melilla por falta de información completa del IPI, lo que reduce ligeramente la cobertura territorial. En segundo lugar, el modelo de panel se basa en especificaciones lineales y no incorpora posibles **efectos no lineales** o interacciones (por ejemplo, entre plazas y ADR) que podrían capturar mejor la competencia entre destinos. Además, la variable IPI se utiliza como proxy de renta disponible, lo que introduce una aproximación indirecta del ciclo económico sobre el turismo.

En el ámbito de series temporales, el pronóstico se construye con un modelo relativamente parsimonioso (es decir, que usa el menor número posible de parámetros o variables y aun así explica bien los datos y tiene buen poder predictivo y con imputaciones puntuales para algunos meses atípicos), lo que puede afectar a la precisión en torno al shock de 2020. Entre las **posibles extensiones** destacan: 

- Incorporar otras variables explicativas de alta frecuencia (por ejemplo, indicadores de movilidad o búsquedas en Google Trends).
- Explorar modelos multivariantes (VAR o modelos de regresión dinámica) que vinculen pernoctaciones con indicadores macroeconómicos.
- Analizar de forma diferenciada segmentos turísticos (nacional vs internacional, costa vs interior) mediante paneles más desagregados.

